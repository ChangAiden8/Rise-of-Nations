add_namespace = veren
add_namespace = ww2_spain

country_event = {
	id = ww2_spain.1
	title = ww2_spain.1.t
	desc = ww2_spain.1.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		name = ww2_spain.1.a
		#complete_national_focus = SPA_CEDA
	}
	option = {
		name = ww2_spain.1.b
		#complete_national_focus = SPR_popular_front
	}
}

#
country_event = {
	id = ww2_spain.2
	hidden = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = spanish_civil_war }
	}
	immediate = {
		random_list = {
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 165.scw_color = 2}
					}
					
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 165.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_catalonia_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 41.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 41.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_madrid_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 168.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 168.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_murcia_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 167.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 167.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_valencia_mission
			}


			20 = {
				# Make republican AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 290.scw_color = 1}
						has_completed_focus = SPA_elite_troops
					}
				}

				#Make nat AI not choose this if already nationalist
				modifier = {
					factor = 0
					check_variable = { 290.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_africa_mission
			}
			20 = {
				# Make rep AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 177.scw_color = 1}
					}
				}

				#Make nat AI not choose this if already nat
				modifier = {
					factor = 0
					check_variable = { 177.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_balear_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 1055.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 1055.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_cordoba_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 173.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 173.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_granada_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 169.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 169.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_andalusia_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 1052.scw_color = 1}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 1052.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_huelva_mission
			}20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 1054.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 1054.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_toledo_mission
			}20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 175.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 175.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_la_mancha_mission
			}
			20 = {
				# Make rep AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 170.scw_color = 1}
					}
				}

				#Make nat AI not choose this if already nat
				modifier = {
					factor = 0
					check_variable = { 170.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_extremadura_mission
			}
			20 = {
				# Make rep AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 175.scw_color = 1}
					}
				}

				#Make nat AI not choose this if already nat
				modifier = {
					factor = 0
					check_variable = { 175.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_leon_mission
			}
			20 = {
				# Make rep AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 171.scw_color = 1}
					}
				}

				#Make nat AI not choose this if already nat
				modifier = {
					factor = 0
					check_variable = { 171.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_galicia_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 1051.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 1051.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_asturias_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 172.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 172.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_navarre_mission
			}
			20 = {
				# Make rep AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 1053.scw_color = 1}
					}
				}

				#Make nat AI not choose this if already nat
				modifier = {
					factor = 0
					check_variable = { 1053.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_alava_mission
			}
			20 = {
				# Make rep AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPA_CEDA
						}
						check_variable = { 176.scw_color = 1}
					}
				}

				#Make nat AI not choose this if already nat
				modifier = {
					factor = 0
					check_variable = { 176.scw_color = 2}
					has_completed_focus = SPR_popular_front
				}
				activate_mission = SPA_expand_influence_in_castille_mission
			}
			20 = {
				# Make nationalist AI not choose this
				modifier = {
					factor = 0
					OR = {
						AND = {
							is_historical_focus_on = yes
							is_ai = yes
							has_completed_focus = SPR_popular_front
						}
						check_variable = { 166.scw_color = 2}
					}
				}

				#Make republican AI not choose this if already republican
				modifier = {
					factor = 0
					check_variable = { 166.scw_color = 1}
					has_completed_focus = SPA_CEDA
				}
				activate_mission = SPA_expand_influence_in_aragon_mission
			}
			
		}
		country_event = { id = ww2_spain.2 days = 15 random_days = 5}
	}
}

country_event = {
	id = ww2_spain.3
	title = ww2_spain.3.t
	desc = ww2_spain.3.d

	is_triggered_only = yes

	immediate = {
		
		disband_all_units = yes
		set_global_flag = spanish_civil_war
		set_global_flag = {flag = SPR_civil_war_startup value = 1 days = 10}
		every_state = {
			limit = {
				is_core_of = SPR
			}
			add_core_of = SPA
		}
		SPA = {
			activate_mission = SPR_carlist_rise
			if = {
				limit = {
					is_historical_focus_on = yes
				}
				add_days_mission_timeout = {
    				mission = SPR_carlist_rise
    				days = 50
				}
			}
			transfer_state = 297
			transfer_state = 178
			transfer_state = 1106
			transfer_state = 699
			transfer_state = 1118
			transfer_state = 1043
			transfer_state = 1044
			country_lock_all_division_template = no
			retire_ideology_leader = democratic
			retire_ideology_leader = neutrality
			retire_ideology_leader = communism

			set_politics = {
				ruling_party = neutrality
			}
			add_popularity = {
			    ideology = democratic
			    popularity = -0.25
			}
			add_popularity = {
			    ideology = communism
				popularity = -0.1
			}
			

			division_template = {
				name = "Guarnición Nacionalista"
				is_locked = yes
				template_counter = 6
				division_names_group = SPR_INF_02
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
				}
			}
			division_template = {
				name = "División del Ejército de África"
				template_counter = 4
				division_names_group = SPR_INF_06
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 1 y = 2 }
					infantry = { x = 2 y = 0 }
					artillery_brigade = { x = 2 y = 1 }
					artillery_brigade = { x = 2 y = 2 }
				}
				support = {
					recon = { x = 0 y = 0 }
					engineer = { x = 0 y = 1 }
				}
			}
			division_template = {
				name = "Requeté Carlista"
				template_counter = 8
				division_names_group = SPR_INF_03
				is_locked = yes
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
				}
			}
			country_event = { id = ww2_spain.5 days = 5}	
		}
		SPR = {
			
			every_character = {
				limit = {
					has_trait = nationalist_spanish
				}
				set_nationality = SPA
			}
			SPR_military_junta = {
				set_nationality = SPA
			}
			SPR_juan_III = {
				set_nationality = SPA
			}
			activate_mission = SPR_anarchist_rise
			if = {
				limit = {
					is_historical_focus_on = yes
				}
				add_days_mission_timeout = {
    				mission = SPR_anarchist_rise
    				days = 50
				}
			}
			#retire_ideology_leader = fascism
			#retire_ideology_leader = neutrality
			#retire_ideology_leader = communism
			country_lock_all_division_template = no
			division_template = {
				name = "Guarnición Republicana"
				is_locked = yes
				template_counter = 6
				division_names_group = SPD_INF_01
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
				}
			}
			division_template = {
				name = "División del Ejército de África"
				template_counter = 4
				division_names_group = SPR_INF_06
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 1 y = 2 }
					infantry = { x = 2 y = 0 }
					artillery_brigade = { x = 2 y = 1 }
					artillery_brigade = { x = 2 y = 2 }
				}
				support = {
					recon = { x = 0 y = 0 }
					engineer = { x = 0 y = 1 }
				}
			}
			transfer_units_fraction = {
				target = SPA
				size = 0
				stockpile_ratio = 0.6
			}
		}
		
		every_owned_state = {
			limit = {
				OR = {
					check_variable = { scw_color = 2 }
				}
			}
			SPA = {
				transfer_state = PREV
			}
			if = {
				limit = {
					THIS = {
						NOT = {
							state = 290
						}
						has_state_flag = units_trained
					}
				}
				THIS = {
			 		create_unit = {
			 			division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.3" 
			 			owner = SPA
			 			allow_spawning_on_enemy_provs = yes
			 			count = 4
			 		}
				}
			}
			if = {
				limit = {
					THIS = {
						NOT = {
							state = 290
						}
						NOT = { has_state_flag = units_trained }
					}
				}
				THIS = {
			 		create_unit = {
			 			division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
			 			owner = SPA
			 			allow_spawning_on_enemy_provs = yes
			 			count = 4
			 		}
				}
			}
			
		}
		
		
		
		290 = {
			create_unit = {
				division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
				owner = 290.OWNER
			}
			create_unit = {
				division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
				owner = 290.OWNER
			}
			create_unit = {
				division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
				owner = 290.OWNER
			}
			create_unit = {
				division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
				owner = 290.OWNER
			}
			create_unit = {
				division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
				owner = 290.OWNER
			}

		}
		1053 = { 
			create_unit = {
				division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
				owner = SPA
				allow_spawning_on_enemy_provs = yes
				count = 5
				
			}
		}
		SPR = {
			every_owned_state = {
				limit = {
					check_variable = { scw_color = 1}
				}
				if = {
					limit = {
						THIS = {
							NOT = {
								state = 290
							}
						}
					}
					THIS = {
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.2" 
							owner = SPR
							allow_spawning_on_enemy_provs = yes
							count = 3
						}
					}
				}
			}
			
		}
		if = {
		 	limit = {
		 		has_completed_focus = SPA_CEDA
		 	}
		 	SPA = { change_tag_from = SPR }
			
		}
		SPA = {
			promote_character = SPR_military_junta
			declare_war_on = {
				target = SPR
				type = civil_war
			}
			add_civil_war_target = SPR
			add_ideas = SPR_no_surrender
		}
		SPR = {
			add_ideas = SPR_no_surrender
		}
	}

	option = {

	}
}

country_event = {
	#Weapon cache found
	id = ww2_spain.4
	title = ww2_spain.4.t
	desc = ww2_spain.4.d

	is_triggered_only = yes



	option = {
		name = ww2_spain.4.a
		set_temp_variable_to_random = {
			var = amount
			min = 100
			max = 200
			integer = yes
		}
		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = var:amount
			producer = SPR
		}
	}
}

unit_leader_event = {
	#the infant wants to join
	id = ww2_spain.5
	title = ww2_spain.5.t
	desc = ww2_spain.5.d

	is_triggered_only = yes

	option = {
		name = ww2_spain.5.a
		ai_chance = {
			base = 10
		}
	}
	option = {
		#Let him cook
		name = ww2_spain.5.b
		ai_chance = { 
			base = 10
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		OWNER = {
			set_country_flag = infante_in_the_army
		}

	}
	option = {
		name = ww2_spain.5.c
	}
}
country_event = {
	id = veren.1
	title = veren.1.t
	desc = veren.1.d
	picture = GFX_report_event_generic_sign_treaty1
	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = veren.1.a
		ai_chance = {
			factor = 80
		}
		SPR = {

			create_faction = "Spanish Axis"
			add_to_faction = POR
			country_event = { id = veren.3 days = 1 }
		}
	}
	option = {
		name = veren.1.b
		ai_chance = {
			factor = 20
		}
		SPR = {
			create_wargoal = {
				type = annex_everything
				target = POR
			}
			country_event = { id = veren.4 days = 1 }
		}
	}
}

country_event = {
	id = veren.2
	title = veren.2.t
	desc = veren.2.d
	picture = GFX_report_event_fascists_posing
	trigger = {
		date > 1933.1.1
		date < 1949.1.1
		OR = {
			AND = {
				tag = SPR
				has_government = fascism
				has_civil_war = yes
			}
			AND = {
				tag = D01
				has_civil_war = yes
				has_government = fascism
			}
		}
	}

	fire_only_once = yes

	mean_time_to_happen = { days = 1 }

	option = {

		name = veren.2.a
		ai_chance = {
			factor = 100
		}
		create_field_marshal = {
			name = "Francisco Franco"
			desc = "POLITICS_FRANCOGEN_DESC"
			picture = "gfx/leaders/SPA/Portrait_Spain_Francisco_Franco.dds"
			traits = { offensive_doctrine }
			skill = 4
		}
	}
}

country_event = {
	id = veren.3
	title = veren.3.t
	desc = veren.3.d
	picture = GFX_report_event_generic_sign_treaty2
	fire_only_once = yes
	is_triggered_only = yes

	option = {

		name = veren.3.a
		ai_chance = {
			factor = 100
		}
	}
}

country_event = {
	id = veren.4
	title = veren.4.t
	desc = veren.4.d
	picture = GFX_report_event_worried_french
	fire_only_once = yes
	is_triggered_only = yes

	mean_time_to_happen = {
		days = 1
	}

	option = {

		name = veren.4.a
		ai_chance = {
			factor = 100
		}
	}
}

country_event = {
	id = veren.5
	title = veren.5.t
	desc = veren.5.d
	picture = GFX_report_event_spr_nuke
	fire_only_once = yes
	is_triggered_only = yes

	option = {

		name = veren.5.a
		ai_chance = {
			factor = 100
		}
		add_threat = 5
	}
}

country_event = {
	id = veren.6
	title = veren.6.t
	desc = veren.6.d
	picture = GFX_report_event_fascists_posing
	trigger = {
		date > 1933.1.1
		date < 1949.1.1
		OR = {
			AND = {
				tag = SPR
				has_government = communism
				has_civil_war = yes
			}
			AND = {
				tag = D01
				has_civil_war = yes
				has_government = communism
			}
		}
	}

	fire_only_once = yes

	mean_time_to_happen = { days = 1 }

	option = {

		name = veren.6.a
		ai_chance = {
			factor = 100
		}
		create_field_marshal = {
			name = "Vicente Rojo Lluch"
			desc = "POLITICS_FRANCOGEN_DESC"
			picture = "gfx/leaders/SPA/SPR_Portrait_Vicente_Lluch.dds"
			traits = { offensive_doctrine }
			skill = 4
		}
	}
}



#Catalonia Indep 1934
#country_event = {
#	id = veren.7
#	title = veren.7.t
#	desc = veren.7.d
#	
#	trigger = {
#		tag = SPR
#		date > 1934.10.1
#		date < 1934.11.1
#	}
#	
#	immediate = {
#		release = CAT
#		
#	}
#	option = {
#		name = veren.7.a
#		declare_war_on = {
#			target = CAT
#			type = annex_everything
#		}
#		add_political_power = -50
#		add_manpower = -100
#	}
#}

country_event = {
	id = veren.8
	title = veren.8.t
	desc = veren.8.d
	picture = GFX_report_event_fascists_posing
	trigger = {
		original_tag = SPR
		has_government = fascism
		date > 1937.1.1
		date < 1951.01.01
	}

	fire_only_once = yes

	mean_time_to_happen = { days = 1 }

	option = {

		name = veren.8.a
		ai_chance = {
			factor = 100
		}
		hidden_effect = {
			set_rule = {
				can_join_factions = no 
				can_create_factions = no
				can_not_declare_war = yes
			}
		}
	}
}
