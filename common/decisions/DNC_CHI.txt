china_influence_sphere = {
	DNC_expand_sphere_of_influence_in_state = {
		on_map_mode = map_only
		state_target = yes
		target_array = QIN_sphere_of_influence_states

		complete_effect = {
			FROM = {
				set_state_flag = {
					flag = recently_contested
					days = 30
				}
			}
		}
		visible = {NOT = { QIN = {has_country_flag = splitted}}  }
		available = {
			
			country_exists = QIN
			custom_trigger_tooltip = {
				tooltip = decision.influence.tooltip
				QIN = {NOT = {has_country_flag = splitted}}
				OR= {
					AND = {
						FROM = {
							any_neighbor_state = {
								is_in_array = {
									array = FRA_influenced_states
									value = THIS
								}
					
							}	
						}
						tag = FRA
					}


					AND = {
						FROM = {
							any_neighbor_state = {
								is_in_array = {
									array = JAP_influenced_states
									value = THIS
								}
							}	
						}
						tag = JAP
					
					}

					AND = {
						FROM = {
							is_in_array = {
								array = GER_influenced_states
								value = THIS
							}
						}
					
						tag = GER
					}

					AND = {
						FROM = {
							any_neighbor_state = {
								is_in_array = {
									array = RUE_influenced_states
									value = THIS
								}
							}	
						}
					
						tag = RUE
					}

					AND = {
						FROM = {
							any_neighbor_state = {
								is_in_array = {
									array = ENG_influenced_states
									value = THIS
								}
							}	
						}
						tag = ENG
					}

					FROM = { has_state_flag = recently_contested }
				}
			}
		}
		cost = 50
		icon = {
			key = GFX_FRA_influence
			trigger = {
				FROM = {
					is_in_array = {
						array = FRA_influenced_states
						value = THIS
					}
				}
			}
	
		}
		icon = {
			key = GFX_JAP_influence
			trigger = {
				FROM = {
					is_in_array = {
						array = JAP_influenced_states
						value = THIS
					}
				}
			}
	
		}
		icon = {
			key = GFX_GER_influence
			trigger = {
				FROM = {
					is_in_array = {
						array = GER_influenced_states
						value = THIS
					}
				}
			}
	
		}
		icon = {
			key = GFX_ENG_influence
			trigger = {
				FROM = {
					is_in_array = {
						array = ENG_influenced_states
						value = THIS
					}
				}
			}
	
		}
		icon = {
			key = GFX_RUE_influence
			trigger = {
				FROM = {
					is_in_array = {
						array = RUE_influenced_states
						value = THIS
					}
				}
			}
	
		}
		ai_will_do = {
			base = 10
			modifier = {
				factor = 16
				FROM = {
					has_state_flag = recently_contested
				}
			}
		}
		days_remove = 14
		remove_effect = {
			#Removing from previous influence
			if = {
				limit = {
					FROM = {
						is_in_array = {
							array = FRA_influenced_states
							value = THIS
						}
					}
				}
				FROM = {
					remove_from_array = { FRA_influenced_states = THIS }
				}
				FRA = {
					remove_resource_rights = FROM
				}
			}
			else_if = {
				limit = {
					FROM = {
						is_in_array = {
							array = JAP_influenced_states
							value = THIS
						}
					}
				}
				FROM = {
					remove_from_array = { JAP_influenced_states = THIS }
				}
				JAP = {
					remove_resource_rights = FROM
				}
			}
			else_if = {
				limit = {
					FROM = {
						is_in_array = {
							array = GER_influenced_states
							value = THIS
						}
					}
				}
				FROM = {
					remove_from_array = { GER_influenced_states = THIS }
				}
				GER = {
					remove_resource_rights = FROM
				}
			}
			else_if = {
				limit = {
					FROM = {
						is_in_array = {
							array = ENG_influenced_states
							value = THIS
						}
					}
				}
				FROM = {
					remove_from_array = { ENG_influenced_states = THIS }
				}
				ENG = {
					remove_resource_rights = FROM
				}
			}
			else_if = {
				limit = {
					FROM = {
						is_in_array = {
							array = RUE_influenced_states
							value = THIS
						}
					}
				}
				FROM = {
					remove_from_array = { RUE_influenced_states = THIS }
				}
				RUE = {
					remove_resource_rights = FROM
				}
			}

			#Add to influenced states array an resource rights
			FROM = {
				add_to_array = { @ROOT_influenced_states = THIS }
			}
			give_resource_rights = {
				receiver = ROOT
				state = FROM
			}
		}
	}
}

chinese_revolution = {

	
	QIN_revolution_timer = {
		name = QIN_revolution_timer
		priority = 10
		allowed = { 
			tag = QIN
		}
		available = {
			hidden_trigger = {always = no}
		
		}
		visible = {always = yes}
		cancel_if_not_visible = yes
		activation = {has_country_flag = uprising_preparing}
		is_good = no
		days_mission_timeout = CHI_days_until_uprising?2700
		
		timeout_effect = {
#				CHI = {add_ideas = {CHI_uprising}}
#				QIN = {add_ideas = {QIN_uprising}}
#				QIN = {set_country_flag = revolution_started}
#					
#			if = {
#				limit = {
#					check_variable = {
#						var = uprising_strengh
#						value = 0.8
#						compare = greater_than
#					}
#
#				}
#			
#			}
#			if = { 
#				limit = {
#					check_variable = {
#						var = uprising_preparing
#						value = 0.05
#						compare = less_than
#					}
#					
#				}
#				
#			}
#			else = {
#				
#			
#			}
#			594 = {add_core_of = CHI}
#			592 = {add_core_of = CHI}
#			747 = {add_core_of = CHI}
#			325 = {add_core_of = CHI}
#			603 = {add_core_of = CHI}
#			752 = {add_core_of = CHI}
#			751 = {add_core_of = CHI}
#			748 = {add_core_of = CHI}
#			596 = {add_core_of = CHI}
#			613 = {add_core_of = CHI}
#			1028 = {add_core_of = CHI}
#			753 = {add_core_of = CHI}
#			615 = {add_core_of = CHI}
#			623 = {add_core_of = CHI}
#			622 = {add_core_of = CHI}
#			750 = {add_core_of = CHI}
#			749 = {add_core_of = CHI}
#			744 = {add_core_of = CHI}
#			1030 = {add_core_of = CHI}
#			606 = {add_core_of = CHI}
#			620 = {add_core_of = CHI}
#			1031 = {add_core_of = CHI}
#			902 = {add_core_of = CHI}
#			600 = {add_core_of = CHI}
#			602 = {add_core_of = CHI}
#			744 = {add_core_of = CHI}
#			598 = {add_core_of = CHI}
#			599 = {add_core_of = CHI}
#			595 = {add_core_of = CHI}
#			593 = {add_core_of = CHI}
#			597 = {add_core_of = CHI}
#			605 = {add_core_of = CHI}
#			QIN = {release = CHI}
#			CHI = {set_province_controller = 1519}
#			CHI = {set_province_controller = 1319}
#			CHI = {set_province_controller = 7014}
#			CHI = {set_province_controller = 4504}
#			QIN = {
#				transfer_units_fraction= {
#					target = CHI
#					size = uprising_strengh
#					stockpile_ratio = uprising_strengh
#					army_ratio = uprising_strengh
#					navy_ratio = 0
#					air_ratio = 0
#				}
#			}
#			QIN = {
#				declare_war_on = {
#					target = CHI
#					type = civil_war
#				}
#			}
#			CHI = {set_cosmetic_tag = CHI_first_republic}
#			CHI = {
#				create_country_leader = {
#					name = "Zhongguo Tongmenghui"
#					picture = "chinese_junta.dds"
#					expire = "1965.1.1"
#					ideology = despotism
#	
#				}	
#			}
#			QIN = {country_event = {id = chinese_empire.16 days = 10}}
#			
#			if = {
#				limit = {
#					AND = {
#						QIN = {has_country_flag = side_with_CHI}
#						QIN = {is_ai = no}
#					}
#				}
#				CHI = { change_tag_from = QIN }
#			}
			country_event = ww1_china.3
		}
		
		
	}
	QIN_fight_uprising = {
		name = QIN_fight_uprising
		available = {NOT = {has_country_flag = revolution_started}}
		visible = {
			has_country_flag = uprising_preparing
			NOT = {has_country_flag = side_with_CHI}
		}
		days_remove = 120
		cost = 100
		remove_effect = {
			set_country_flag = fighting_uprising
			subtract_from_variable = {
				var = uprising_strengh
				value = 0.05
				
			}
		}
	}
	CHI_spread_uprising = {
		name = CHI_spread_uprising
		cost = 100
		available = {NOT = {has_country_flag = revolution_started}}
		visible = {
			has_country_flag = uprising_preparing
			NOT = {has_country_flag = side_with_QIN}
		}
		days_remove = 100
		remove_effect = {
			set_country_flag = uprising_spreading
			add_to_variable = {
				var = uprising_strengh
				value = 0.03
			}
		
		}
	}
	QIN_arrest_leaders = {
		name = QIN_arrest_leaders
		cost = 200
		available = {NOT = {has_country_flag = revolution_started}}
		visible = {
			has_country_flag = uprising_preparing
			NOT = {has_country_flag = side_with_CHI}}
		days_remove = 100
		remove_effect = {
			set_country_flag = leader_arrested
			add_days_mission_timeout = {
				mission = QIN_revolution_timer
				days = 50
			
			}
		}
	}
	CHI_attack_garrisons = {
		name = CHI_attack_garrisons
		cost = 150
		available = {NOT = {has_country_flag = revolution_started}}
		visible = {
			AND = {
				has_country_flag = uprising_preparing
				has_country_flag = side_with_CHI
			}
		}
		days_remove = 75
		remove_effect = {
			set_country_flag = garrisons_attacked
			add_days_mission_timeout = {
				mission = QIN_revolution_timer
				days = -50
			
			}
		}
	}
	QIN_fight_uprising_AI = {
		name = QIN_fight_uprising
		available = {hidden_trigger = {always = no}}
		visible = {has_country_flag = uprising_preparing}
		activation = {has_country_flag = uprising_spreading}
		allowed = {
			tag = QIN
		}
		is_good = yes
		days_mission_timeout = 120
		timeout_effect = {
			subtract_from_variable = {
				var = uprising_strengh
				value = 0.05
				
			}
			clr_country_flag = uprising_spreading
			
		}	
	}
	CHI_spread_uprising_AI = {
		name = CHI_spread_uprising
		available = {has_country_flag = revolution_started}
		visible = {has_country_flag = uprising_preparing}
		activation = {has_country_flag = fighting_uprising}
		allowed = {tag = QIN}
		is_good = yes
		days_mission_timeout = 100
		timeout_effect = {
			add_to_variable = {
				var = uprising_strengh
				value = 0.03
			}
			clr_country_flag = fighting_uprising
		
		}
	}
	QIN_arrest_leaders_AI = {
		name = QIN_arrest_leaders
		available = {has_country_flag = revolution_started}
		visible = {has_country_flag = uprising_preparing}
		activation = {has_country_flag = garrisons_attacked}
		allowed = {tag = QIN}
		days_mission_timeout = 100
		timeout_effect = {
			add_days_mission_timeout = {
				mission = QIN_revolution_timer
				days = 50
			}
			clr_country_flag = garrisons_attacked
		}
	}
	CHI_attack_garrisons_AI = {
		name = CHI_attack_garrisons
		available = {has_country_flag = revolution_started}
		visible = {has_country_flag = uprising_preparing}
		activation = {has_country_flag = leader_arrested}
		allowed = {tag = QIN}
		days_mission_timeout = 75
		timeout_effect = {
			add_days_mission_timeout = {
				mission = QIN_revolution_timer
				days = -50
			
			}
			clr_country_flag = leader_arrested
		}
	}

}
